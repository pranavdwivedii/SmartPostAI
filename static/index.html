<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social Media Content Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-4xl font-bold text-center text-gray-800 mb-8">Social Media Post Generator</h1>
        
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label for="baseUrl" class="block text-sm font-medium text-gray-700 mb-1">Base URL</label>
                    <input type="url" id="baseUrl" placeholder="Enter base URL" required
                           class="w-full px-3 py-2 placeholder-gray-400 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-indigo-100 focus:border-indigo-300">
                </div>
                <div>
                    <label for="tone" class="block text-sm font-medium text-gray-700 mb-1">Preferred Tone</label>
                    <input type="text" id="tone" placeholder="e.g., casual, professional"
                           class="w-full px-3 py-2 placeholder-gray-400 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-indigo-100 focus:border-indigo-300">
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label for="topics" class="block text-sm font-medium text-gray-700 mb-1">Preferred Topics</label>
                    <input type="text" id="topics" placeholder="e.g., tech, lifestyle"
                           class="w-full px-3 py-2 placeholder-gray-400 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-indigo-100 focus:border-indigo-300">
                </div>
                <div>
                    <label for="language" class="block text-sm font-medium text-gray-700 mb-1">Target Language</label>
                    <select id="language" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-indigo-100 focus:border-indigo-300">
                        <option value="en">English</option>
                        <option value="es">Spanish</option>
                        <option value="fr">French</option>
                        <option value="de">German</option>
                        <option value="it">Italian</option>
                        <option value="pt">Portuguese</option>
                        <option value="ru">Russian</option>
                        <option value="ja">Japanese</option>
                        <option value="ko">Korean</option>
                        <option value="zh">Chinese (Simplified)</option>
                    </select>
                </div>
            </div>
            <button id="generateBtn" class="w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition duration-150 ease-in-out">
                Generate Social Media Posts
            </button>
        </div>

        <div id="loader" class="hidden">
            <div class="flex justify-center items-center mb-4">
                <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500"></div>
            </div>
            <p class="text-center text-gray-600">Generating content...</p>
        </div>

        <div id="result" class="text-center text-lg font-semibold mb-4"></div>

        <div id="postsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </div>

    <script>
        const generateBtn = document.getElementById('generateBtn');
        const baseUrlInput = document.getElementById('baseUrl');
        const toneInput = document.getElementById('tone');
        const topicsInput = document.getElementById('topics');
        const languageSelect = document.getElementById('language');
        const loader = document.getElementById('loader');
        const resultDiv = document.getElementById('result');
        const postsContainer = document.getElementById('postsContainer');

        function isValidUrl(url) {
            try {
                new URL(url);
                return true;
            } catch (_) {
                return false;
            }
        }

        function displayPosts(posts) {
            postsContainer.innerHTML = '';
            posts.forEach(post => {
                const postDiv = document.createElement('div');
                postDiv.className = 'bg-white rounded-lg shadow-md overflow-hidden transition-transform duration-300 transform hover:scale-105';
                postDiv.innerHTML = `
                    <img src="${post.image_url}" alt="Post image" class="w-full h-48 object-cover">
                    <div class="p-4">
                        <p class="text-gray-800 mb-2">${post.post_content}</p>
                        <a href="${post.url}" target="_blank" class="text-indigo-600 hover:text-indigo-800 transition duration-150 ease-in-out">
                            <i class="fas fa-external-link-alt mr-1"></i>Read More
                        </a>
                    </div>
                `;
                postsContainer.appendChild(postDiv);
            });
        }

        generateBtn.addEventListener('click', async () => {
            const baseUrl = baseUrlInput.value.trim();
            const tone = toneInput.value.trim();
            const topics = topicsInput.value.trim();
            const language = languageSelect.value;

            if (!isValidUrl(baseUrl)) {
                resultDiv.textContent = 'Please enter a valid URL (including http:// or https://)';
                resultDiv.className = 'text-center text-red-600 text-lg font-semibold mb-4';
                return;
            }

            const preferences = {
                tone: tone || "No preference",
                topics: topics || "No preference",
                language: language
            };

            resultDiv.textContent = '';
            loader.classList.remove('hidden');
            postsContainer.innerHTML = '';

            try {
                await fetch('/save_preferences', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(preferences),
                });

                const response = await fetch('/scrape_and_generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ url: baseUrl, language: language }),
                });

                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }

                const result = await response.json();

                const postsResponse = await fetch('/posts.json');
                const posts = await postsResponse.json();

                displayPosts(posts);
                resultDiv.textContent = 'Content generated successfully!';
                resultDiv.className = 'text-center text-green-600 text-lg font-semibold mb-4';
            } catch (error) {
                console.error('Error:', error);
                resultDiv.textContent = `Error: ${error.message}`;
                resultDiv.className = 'text-center text-red-600 text-lg font-semibold mb-4';
            } finally {
                loader.classList.add('hidden');
            }
        });
    </script>
</body>
</html>